<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Simulasi Absen AF PRODUCTIONS</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: #f0f2f5;
    margin: 0; padding: 0;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
  }
  #loginPage, #absenPage {
    background: white;
    border-radius: 10px;
    box-shadow: 0 8px 20px rgb(0 0 0 / 0.1);
    padding: 2rem;
    max-width: 400px;
    width: 90%;
    display: none;
  }
  #loginPage.active, #absenPage.active {
    display: block;
  }
  h2 {
    text-align: center;
    color: #0d6efd;
    margin-bottom: 1rem;
  }
  input, button, textarea {
    width: 100%;
    margin-top: 1rem;
    padding: 0.75rem;
    font-size: 1rem;
    border-radius: 6px;
    border: 1px solid #ccc;
    box-sizing: border-box;
  }
  button {
    background-color: #0d6efd;
    border: none;
    color: white;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  button:hover {
    background-color: #0b5ed7;
  }
  #logoutBtn {
    background: #dc3545;
    margin-top: 1rem;
  }
  #timeDisplay {
    text-align: center;
    font-weight: bold;
    margin-top: 0.5rem;
    font-size: 1.1rem;
    color: #333;
  }
  #riwayatList {
    margin-top: 1rem;
    max-height: 180px;
    overflow-y: auto;
    background: #eef2ff;
    padding: 1rem;
    border-radius: 6px;
    font-size: 0.9rem;
  }
  video {
    width: 100%;
    border-radius: 6px;
    margin-top: 1rem;
    background: black;
  }
</style>
</head>
<body>

<div id="loginPage" class="active">
  <h2>Login Absen</h2>
  <input type="text" id="loginNoInduk" placeholder="üÜî No Induk" />
  <input type="password" id="loginPassword" placeholder="üîí Password" />
  <button id="loginBtn">Login</button>
</div>

<div id="absenPage">
  <h2>Absensi AF PRODUCTIONS</h2>
  <div id="timeDisplay"></div>

  <form id="absenForm" onsubmit="return false;">
    <button id="btnMasuk">‚úÖ Absen Masuk</button>
    <button id="btnPulang" style="background-color: #dc3545;">‚èπÔ∏è Absen Pulang</button>
  </form>

  <video id="video" autoplay muted playsinline></video>

  <div id="riwayatContainer">
    <h3>üìã Riwayat Absen</h3>
    <div id="riwayatList">Belum ada data absen.</div>
  </div>

  <button id="logoutBtn">Logout</button>
</div>

<script>
  // --- Variables ---
  const loginPage = document.getElementById("loginPage");
  const absenPage = document.getElementById("absenPage");
  const loginNoInduk = document.getElementById("loginNoInduk");
  const loginPassword = document.getElementById("loginPassword");
  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const timeDisplay = document.getElementById("timeDisplay");
  const btnMasuk = document.getElementById("btnMasuk");
  const btnPulang = document.getElementById("btnPulang");
  const riwayatList = document.getElementById("riwayatList");
  const video = document.getElementById("video");

  let currentUser = null;
  let absenStatus = { masuk: false, pulang: false };
  let riwayat = [];

  // --- Functions ---

  function updateTime() {
    const now = new Date();
    timeDisplay.textContent = now.toLocaleString("id-ID", { dateStyle: "full", timeStyle: "medium" });
  }

  function tampilkanRiwayat() {
    if(riwayat.length === 0) {
      riwayatList.textContent = "Belum ada data absen.";
      return;
    }
    riwayatList.innerHTML = "";
    riwayat.forEach(item => {
      riwayatList.innerHTML += `<div>[${item.waktu}] - ${item.tipe.toUpperCase()} - User: ${item.user}</div>`;
    });
  }

  function mulaiKamera() {
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
      alert("Browser tidak mendukung akses kamera.");
      return;
    }
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => {
        video.srcObject = stream;
      })
      .catch(() => alert("Gagal mengakses kamera."));
  }

  function stopKamera() {
    if (video.srcObject) {
      video.srcObject.getTracks().forEach(track => track.stop());
      video.srcObject = null;
    }
  }

  function simpanRiwayat(tipe) {
    const waktu = new Date().toLocaleString("id-ID", { dateStyle: "short", timeStyle: "short" });
    riwayat.push({ waktu, tipe, user: currentUser });
    localStorage.setItem("riwayatAbsen", JSON.stringify(riwayat));
    tampilkanRiwayat();
  }

  function loadRiwayat() {
    const data = localStorage.getItem("riwayatAbsen");
    if (data) {
      riwayat = JSON.parse(data);
    }
    tampilkanRiwayat();
  }

  function login() {
    const user = loginNoInduk.value.trim();
    const pass = loginPassword.value.trim();

    if (!user || !pass) {
      alert("Isi No Induk dan Password.");
      return;
    }
    // Simulasi validasi
    if(pass !== "1234") {
      alert("Password salah!");
      return;
    }
    currentUser = user;
    absenStatus = { masuk: false, pulang: false };
    loginPage.classList.remove("active");
    absenPage.classList.add("active");
    loadRiwayat();
    mulaiKamera();
    updateTime();
    setInterval(updateTime, 1000);
  }

  function logout() {
    stopKamera();
    currentUser = null;
    absenStatus = { masuk: false, pulang: false };
    riwayat = [];
    localStorage.removeItem("riwayatAbsen");
    absenPage.classList.remove("active");
    loginPage.classList.add("active");
    loginNoInduk.value = "";
    loginPassword.value = "";
  }

  function absen(tipe) {
    if(tipe === "pulang" && !absenStatus.masuk) {
      alert("Kamu belum absen masuk!");
      return;
    }
    if(absenStatus[tipe]) {
      alert(`Kamu sudah absen ${tipe}.`);
      return;
    }
    // Simulasi absen berhasil
    absenStatus[tipe] = true;
    simpanRiwayat(tipe);
    alert(tipe === "masuk" ? "‚úÖ Selamat bekerja!" : "‚úÖ Terima kasih, hati-hati di jalan!");
  }

  // --- Event Listeners ---
  loginBtn.addEventListener("click", login);
  logoutBtn.addEventListener("click", logout);
  btnMasuk.addEventListener("click", () => absen("masuk"));
  btnPulang.addEventListener("click", () => absen("pulang"));

</script>

</body>
</html>
